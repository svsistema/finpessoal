{% extends "base.html" %}

{% block title %}Relat√≥rio de Cart√µes{% endblock %}

{% block content %}
<div class="page-header">
    <div class="breadcrumb">
        <a href="{{ url_for('dashboard') }}">üìä Dashboard</a> / <span>Cart√µes de Cr√©dito</span>
    </div>
    <h1>An√°lise de Cart√µes de Cr√©dito</h1>
    <p>Acompanhamento de uso, limites e otimiza√ß√£o de gastos</p>
</div>

<!-- FILTROS -->
<div class="card">
    <form method="GET">
        <div class="form-grid cols-3">
            <div class="form-group" style="margin-bottom: 0;">
                <label>M√™s de Refer√™ncia:</label>
                <input type="month" name="mes" value="2025-10">
            </div>
            <div class="form-group" style="margin-bottom: 0;">
                <label>Compartilhado:</label>
                <select name="compartilhado">
                    <option value="Todos">Todos</option>
                    <option value="100% Silvia">100% Silvia</option>
                    <option value="100% Nelson">100% Nelson</option>
                    <option value="50/50">50/50</option>
                </select>
            </div>
            <button type="submit" class="btn" style="align-self: end;">Filtrar</button>
        </div>
    </form>
</div>

<!-- KPIs DE CART√ïES -->
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px;">
    <div class="card">
        <div style="font-size: 13px; color: #64748b; margin-bottom: 8px; font-weight: 600;">TOTAL GASTO NO M√äS</div>
        <div style="font-size: 32px; font-weight: 700; color: #ef4444; margin-bottom: 8px;">R$ 4.280,00</div>
        <div style="font-size: 13px; color: #64748b;">Em 3 cart√µes ativos</div>
    </div>

    <div class="card">
        <div style="font-size: 13px; color: #64748b; margin-bottom: 8px; font-weight: 600;">LIMITE TOTAL</div>
        <div style="font-size: 32px; font-weight: 700; color: #1e293b; margin-bottom: 8px;">R$ 15.000,00</div>
        <div style="font-size: 13px; color: #64748b;">Dispon√≠vel: R$ 10.720,00</div>
    </div>

    <div class="card">
        <div style="font-size: 13px; color: #64748b; margin-bottom: 8px; font-weight: 600;">UTILIZA√á√ÉO M√âDIA</div>
        <div style="font-size: 32px; font-weight: 700; color: #f59e0b; margin-bottom: 8px;">28,5%</div>
        <div style="font-size: 13px; color: #64748b;">Ideal: abaixo de 30%</div>
    </div>

    <div class="card">
        <div style="font-size: 13px; color: #64748b; margin-bottom: 8px; font-weight: 600;">PR√ìXIMOS VENCIMENTOS</div>
        <div style="font-size: 32px; font-weight: 700; color: #667eea; margin-bottom: 8px;">2</div>
        <div style="font-size: 13px; color: #64748b;">Nos pr√≥ximos 7 dias</div>
    </div>
</div>

<!-- ALERTAS -->
<div class="alert alert-warning" style="margin-bottom: 30px;">
    <strong>‚ö†Ô∏è Aten√ß√£o!</strong> Cart√£o Mastercard Platinum est√° com 72% do limite utilizado. Considere reduzir gastos at√© o fechamento.
</div>

<!-- VIS√ÉO GERAL DOS CART√ïES -->
<div class="card" style="margin-bottom: 30px;">
    <div class="card-title">Status dos Cart√µes - Outubro/2025</div>
    <table>
        <thead>
            <tr>
                <th>Cart√£o</th>
                <th>Banco</th>
                <th>Vencimento</th>
                <th style="text-align: right;">Limite</th>
                <th style="text-align: right;">Gasto</th>
                <th style="text-align: right;">Dispon√≠vel</th>
                <th style="text-align: right;">Utiliza√ß√£o</th>
                <th>Status</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><strong>Visa Infinite</strong></td>
                <td>Banco A</td>
                <td>Dia 10</td>
                <td style="text-align: right;">R$ 8.000,00</td>
                <td style="text-align: right;">R$ 1.450,00</td>
                <td style="text-align: right;">R$ 6.550,00</td>
                <td style="text-align: right;"><span class="badge badge-success">18%</span></td>
                <td><span class="badge badge-success">Saud√°vel</span></td>
            </tr>
            <tr>
                <td><strong>Mastercard Platinum</strong></td>
                <td>Banco B</td>
                <td>Dia 5</td>
                <td style="text-align: right;">R$ 5.000,00</td>
                <td style="text-align: right;">R$ 2.100,00</td>
                <td style="text-align: right;">R$ 2.900,00</td>
                <td style="text-align: right;"><span class="badge badge-warning">42%</span></td>
                <td><span class="badge badge-warning">Aten√ß√£o</span></td>
            </tr>
            <tr>
                <td><strong>Elo Nanquim</strong></td>
                <td>Banco C</td>
                <td>Dia 15</td>
                <td style="text-align: right;">R$ 2.000,00</td>
                <td style="text-align: right;">R$ 730,00</td>
                <td style="text-align: right;">R$ 1.270,00</td>
                <td style="text-align: right;"><span class="badge badge-success">37%</span></td>
                <td><span class="badge badge-success">Saud√°vel</span></td>
            </tr>
            <tr style="background: #f8fafc; font-weight: 600;">
                <td colspan="3"><strong>TOTAL</strong></td>
                <td style="text-align: right;"><strong>R$ 15.000,00</strong></td>
                <td style="text-align: right;"><strong>R$ 4.280,00</strong></td>
                <td style="text-align: right;"><strong>R$ 10.720,00</strong></td>
                <td style="text-align: right;"><strong>28,5%</strong></td>
                <td></td>
            </tr>
        </tbody>
    </table>
</div>

<!-- GR√ÅFICOS -->
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(450px, 1fr)); gap: 20px; margin-bottom: 30px;">
    <!-- Evolu√ß√£o Mensal -->
    <div class="card">
        <div class="card-title">Evolu√ß√£o de Gastos por Cart√£o (√öltimos 6 Meses)</div>
        <div style="position: relative; height:300px; width:100%">
            <canvas id="evolucaoCartoesChart" height="300"></canvas>
        </div>
    </div>

    <!-- Distribui√ß√£o por Categoria -->
    <div class="card">
        <div class="card-title">Distribui√ß√£o de Gastos por Categoria</div>
            <div style="position: relative; height:300px; width:100%">
            <canvas id="categoriasCartaoChart" height="300"></canvas>
        </div>
    </div>

    <!-- Utiliza√ß√£o do Limite -->
    <div class="card">
        <div class="card-title">Hist√≥rico de Utiliza√ß√£o do Limite (%)</div>
        <div style="position: relative; height:300px; width:100%">
            <canvas id="utilizacaoLimiteChart" height="300"></canvas>
        </div>
    </div>


    <!-- Gastos por Dia do M√™s -->
    <div class="card">
        <div class="card-title">Padr√£o de Compras - Dia do M√™s</div>
        <div style="position: relative; height:300px; width:100%">
            <canvas id="padraoComprasChart" height="300"></canvas>
        </div>
    </div>
</div>

<!-- AN√ÅLISE POR CART√ÉO -->
<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px; margin-bottom: 30px;">
    <!-- Visa Infinite -->
    <div class="card">
        <h3 style="margin-bottom: 20px; color: #1e293b; display: flex; justify-content: space-between; align-items: center;">
            <span>üí≥ Visa Infinite</span>
            <span class="badge badge-success">18%</span>
        </h3>
        <div style="margin-bottom: 15px;">
            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                <span style="font-size: 13px; color: #64748b;">Utiliza√ß√£o</span>
                <span style="font-size: 13px; font-weight: 600;">R$ 1.450 / R$ 8.000</span>
            </div>
            <div style="background: #e2e8f0; height: 8px; border-radius: 4px; overflow: hidden;">
                <div style="background: #10b981; height: 100%; width: 18%;"></div>
            </div>
        </div>
        <div style="font-size: 13px; color: #64748b; margin-bottom: 10px;">
            <strong>Principais Gastos:</strong>
        </div>
        <ul style="font-size: 13px; color: #64748b; margin: 0; padding-left: 20px;">
            <li>Supermercado: R$ 680,00</li>
            <li>Postos: R$ 420,00</li>
            <li>Restaurantes: R$ 350,00</li>
        </ul>
        <div style="margin-top: 15px; padding: 10px; background: #f0fdf4; border-radius: 6px;">
            <small style="color: #065f46;">‚úì Cart√£o em situa√ß√£o saud√°vel. Continue assim!</small>
        </div>
    </div>

    <!-- Mastercard Platinum -->
    <div class="card">
        <h3 style="margin-bottom: 20px; color: #1e293b; display: flex; justify-content: space-between; align-items: center;">
            <span>üí≥ Mastercard Platinum</span>
            <span class="badge badge-warning">42%</span>
        </h3>
        <div style="margin-bottom: 15px;">
            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                <span style="font-size: 13px; color: #64748b;">Utiliza√ß√£o</span>
                <span style="font-size: 13px; font-weight: 600;">R$ 2.100 / R$ 5.000</span>
            </div>
            <div style="background: #e2e8f0; height: 8px; border-radius: 4px; overflow: hidden;">
                <div style="background: #f59e0b; height: 100%; width: 42%;"></div>
            </div>
        </div>
        <div style="font-size: 13px; color: #64748b; margin-bottom: 10px;">
            <strong>Principais Gastos:</strong>
        </div>
        <ul style="font-size: 13px; color: #64748b; margin: 0; padding-left: 20px;">
            <li>Eletr√¥nicos: R$ 850,00</li>
            <li>Vestu√°rio: R$ 620,00</li>
            <li>Farm√°cia: R$ 380,00</li>
        </ul>
        <div style="margin-top: 15px; padding: 10px; background: #fef3c7; border-radius: 6px;">
            <small style="color: #92400e;">‚ö† Aten√ß√£o: Vence dia 5. Evite novas compras grandes.</small>
        </div>
    </div>

    <!-- Elo Nanquim -->
    <div class="card">
        <h3 style="margin-bottom: 20px; color: #1e293b; display: flex; justify-content: space-between; align-items: center;">
            <span>üí≥ Elo Nanquim</span>
            <span class="badge badge-success">37%</span>
        </h3>
        <div style="margin-bottom: 15px;">
            <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                <span style="font-size: 13px; color: #64748b;">Utiliza√ß√£o</span>
                <span style="font-size: 13px; font-weight: 600;">R$ 730 / R$ 2.000</span>
            </div>
            <div style="background: #e2e8f0; height: 8px; border-radius: 4px; overflow: hidden;">
                <div style="background: #10b981; height: 100%; width: 37%;"></div>
            </div>
        </div>
        <div style="font-size: 13px; color: #64748b; margin-bottom: 10px;">
            <strong>Principais Gastos:</strong>
        </div>
        <ul style="font-size: 13px; color: #64748b; margin: 0; padding-left: 20px;">
            <li>Streaming: R$ 120,00</li>
            <li>Uber: R$ 280,00</li>
            <li>iFood: R$ 330,00</li>
        </ul>
        <div style="margin-top: 15px; padding: 10px; background: #f0fdf4; border-radius: 6px;">
            <small style="color: #065f46;">‚úì Uso adequado. Vence dia 15.</small>
        </div>
    </div>
</div>

<!-- DICAS E OTIMIZA√á√ïES -->
<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 30px;">
    <div class="card" style="background: #eff6ff; border-left: 4px solid #3b82f6;">
        <h3 style="color: #1e40af; margin-bottom: 15px; font-size: 16px;">üí° Dicas de Otimiza√ß√£o</h3>
        <ul style="list-style: none; padding: 0; margin: 0;">
            <li style="padding: 8px 0; border-bottom: 1px solid #bfdbfe; color: #1e40af;">
                ‚Üí Use o Visa Infinite para grandes compras (melhor limite dispon√≠vel)
            </li>
            <li style="padding: 8px 0; border-bottom: 1px solid #bfdbfe; color: #1e40af;">
                ‚Üí Evite parcelar no Mastercard (j√° est√° com 42% de uso)
            </li>
            <li style="padding: 8px 0; border-bottom: 1px solid #bfdbfe; color: #1e40af;">
                ‚Üí Concentre gastos recorrentes no Elo (vence depois)
            </li>
            <li style="padding: 8px 0; color: #1e40af;">
                ‚Üí Melhor per√≠odo para compras: ap√≥s dia 15 (p√≥s-fechamento)
            </li>
        </ul>
    </div>

    <div class="card" style="background: #fef3c7; border-left: 4px solid #f59e0b;">
        <h3 style="color: #92400e; margin-bottom: 15px; font-size: 16px;">üìÖ Calend√°rio de Vencimentos</h3>
        <ul style="list-style: none; padding: 0; margin: 0;">
            <li style="padding: 8px 0; border-bottom: 1px solid #fde68a; color: #92400e;">
                <strong>Dia 5:</strong> Mastercard Platinum - R$ 2.100,00
            </li>
            <li style="padding: 8px 0; border-bottom: 1px solid #fde68a; color: #92400e;">
                <strong>Dia 10:</strong> Visa Infinite - R$ 1.450,00
            </li>
            <li style="padding: 8px 0; border-bottom: 1px solid #fde68a; color: #92400e;">
                <strong>Dia 15:</strong> Elo Nanquim - R$ 730,00
            </li>
            <li style="padding: 8px 0; color: #92400e;">
                <strong>Total do m√™s:</strong> R$ 4.280,00
            </li>
        </ul>
    </div>
</div>

<script>
// Evolu√ß√£o por Cart√£o
const ctx1 = document.getElementById('evolucaoCartoesChart').getContext('2d');
new Chart(ctx1, {
    type: 'line',
    data: {
        labels: ['Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out'],
        datasets: [
            {
                label: 'Visa Infinite',
                data: [1320, 1580, 1420, 1650, 1480, 1450],
                borderColor: '#667eea',
                tension: 0.4
            },
            {
                label: 'Mastercard Platinum',
                data: [1850, 2200, 1950, 2100, 2350, 2100],
                borderColor: '#f59e0b',
                tension: 0.4
            },
            {
                label: 'Elo Nanquim',
                data: [650, 720, 680, 750, 810, 730],
                borderColor: '#10b981',
                tension: 0.4
            }
        ]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: { position: 'top' }
        }
    }
});

// Categorias
const ctx2 = document.getElementById('categoriasCartaoChart').getContext('2d');
new Chart(ctx2, {
    type: 'doughnut',
    data: {
        labels: ['Supermercado', 'Restaurantes', 'Transporte', 'Eletr√¥nicos', 'Vestu√°rio', 'Outros'],
        datasets: [{
            data: [680, 670, 700, 850, 620, 760],
            backgroundColor: ['#667eea', '#10b981', '#f59e0b', '#ef4444', '#8b5cf6', '#64748b']
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: { position: 'right' }
        }
    }
});

// Utiliza√ß√£o do Limite
const ctx3 = document.getElementById('utilizacaoLimiteChart').getContext('2d');
new Chart(ctx3, {
    type: 'bar',
    data: {
        labels: ['Mai', 'Jun', 'Jul', 'Ago', 'Set', 'Out'],
        datasets: [{
            label: 'Utiliza√ß√£o (%)',
            data: [25, 32, 28, 31, 35, 28.5],
            backgroundColor: function(context) {
                const value = context.parsed.y;
                return value > 30 ? '#f59e0b' : '#10b981';
            }
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: { display: false }
        },
        scales: {
            y: {
                beginAtZero: true,
                max: 100,
                ticks: {
                    callback: function(value) {
                        return value + '%';
                    }
                }
            }
        }
    }
});

// Padr√£o de Compras
const ctx4 = document.getElementById('padraoComprasChart').getContext('2d');
new Chart(ctx4, {
    type: 'bar',
    data: {
        labels: ['1-5', '6-10', '11-15', '16-20', '21-25', '26-31'],
        datasets: [{
            label: 'Gastos por Per√≠odo',
            data: [520, 890, 1250, 780, 580, 260],
            backgroundColor: '#667eea'
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: { display: false }
        }
    }
});
</script>

{% endblock %}