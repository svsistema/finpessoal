{% extends "base.html" %}

{% block title %}Cadastro de Categorias{% endblock %}

{% block content %}
    <h2>Cadastro de Categorias</h2>

    <form method="POST" action="{{ url_for('categorias') }}">
        <div class="form-group">
            <label for="descricao">Descrição da Categoria:</label>
            <input type="text" id="descricao" name="descricao" required autocomplete="off">
        </div>
        <div class="form-group">
            <label for="tipo">Tipo:</label>
            <select id="tipo" name="tipo" required>
                <option value="">-- Selecione o tipo --</option>
                <option value="Receita">Receita</option>
                <option value="Despesa">Despesa</option>
            </select>
        </div>
        <button type="submit" class="btn btn-primary">Adicionar Categoria</button>
    </form>

    <h2 style="margin-top: 2rem;">Categorias Cadastradas</h2>

    <div class="action-buttons" style="margin-bottom: 1rem;">
        <a href="#" id="btn-editar" class="btn btn-secondary" disabled>Editar Selecionado</a>
        <button type="submit" form="form-excluir" id="btn-excluir" class="btn btn-danger" disabled>Excluir Selecionado</button>
    </div>

    <form id="form-excluir" method="POST" action="#" onsubmit="return confirm('Tem certeza que deseja excluir a categoria selecionada?');"></form>

    <table>
        <thead>
            <tr>
                <th style="width: 5%;"></th>
                <th>Descrição</th>
                <th>Tipo</th>
            </tr>
        </thead>
        <tbody>
            {% for cat in categorias %}
            <tr id="row-{{ cat.id }}">
                <td>
                    <input type="radio" name="selecionado" value="{{ cat.id }}" onchange="itemSelecionado(this)">
                </td>
                <td>{{ cat.descricao }}</td>
                <td>{{ cat.tipo }}</td>
            </tr>
            {% else %}
            <tr>
                <td colspan="3">Nenhuma categoria cadastrada.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <script>
        const btnEditar = document.getElementById('btn-editar');
        const btnExcluir = document.getElementById('btn-excluir');
        const formExcluir = document.getElementById('form-excluir');

        function itemSelecionado(radio) {
            const id = radio.value;
            btnEditar.removeAttribute('disabled');
            btnExcluir.removeAttribute('disabled');
            btnEditar.href = `/categorias/edit/${id}`; 
            formExcluir.action = `/categorias/delete/${id}`;

            document.querySelectorAll('tbody tr').forEach(row => row.style.backgroundColor = '');
            document.getElementById(`row-${id}`).style.backgroundColor = '#e0f7fa';
        }
    </script>
{% endblock %}